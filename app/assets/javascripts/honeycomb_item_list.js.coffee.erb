<% url = Rails.application.routes.url_helpers %>

class window.HoneycombItemList
  constructor: (@exhibit_id) ->
    @data = []
    @itemsByID = {}
    @loaded = false

  load: ->
    $.getJSON(@jsonURL())
      .success(@loadSuccess.bind(@))

  loadSuccess: (data) ->
    @loadData(data)

  loadData: (data) ->
    @data = data
    @items = []
    @itemsByID = {}
    $.each(data.items, @loadDataEach.bind(@))
    console.log(@items)

  loadDataEach: (index, itemData) ->
    @loadItem(itemData)

  loadItem: (itemData) ->
    @addItem(@buildItem(itemData))

  addItem: (item) ->
    @items.push(item)
    @itemsByID[item.id] = item

  buildItem: (itemData) ->
    new HoneycombItem(itemData)


  jsonURL: ->
    urlTemplate = "<%= CGI.unescape(url.exhibit_items_path('{exhibit_id}', :json)) %>"
    urlTemplate.replace('{exhibit_id}', @exhibit_id)

$(document).ready ->
  window.itemList = new HoneycombItemList(2)
  itemList.load()
